---
name: changelog

on:
  workflow_dispatch:
  push:
    tags:
      - v*

env:
  BRANCH: main
  COMMITTER_BOT: GitHub <noreply@github.com>
  AUTHOR_BOT: actions-bot <actions-bot@users.noreply.github.com>

jobs:
  update-changelog:
    runs-on: ubuntu-latest
    name: changelog-generator
    # if: "!contains(github.event.head_commit.message, 'skip')"
    steps:
    # To use this repository's private action, you must check out the repository
    - name: "ğŸ“¥ Check-out"
      uses: actions/checkout@v2.3.4
      with:
        fetch-depth: 0

    - name: update changelog
      uses: heinrichreimer/github-changelog-generator-action@v2.1.1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        output: CHANGELOG.md
        # headerLabel: "# ğŸ“‘ Changelog"
        # breakingLabel: '### ğŸ’¥ Breaking'
        # enhancementLabel: '### ğŸš€ Enhancements'
        # bugsLabel: '### ğŸ› Bug fixes'
        # deprecatedLabel: '### âš ï¸ Deprecations'
        # removedLabel: '### ğŸ”¥ Removals'
        # securityLabel: '### ğŸ›¡ï¸ Security'
        # issuesLabel: '### ğŸ“ Other issues'
        # prLabel: '### ğŸ“ Other pull requests'
        # addSections: '{"documentation":{"prefix":"### ğŸ“– Documentation","labels":["documentation"]},"tests":{"prefix":"### âœ… Testing","labels":["tests"]}}'
        # issues: true
        # issuesWoLabels: true
        # pullRequests: true
        # prWoLabels: true
        # author: true
        # unreleased: true
        # compareLink: true
        # stripGeneratorNotice: true

    - name: read 'templates/changelog'
      id: ch-template
      uses: juliangruber/read-file-action@v1
      with:
        path: .github/templates/changelog

    # - name: write to changelog.md
    #   uses: DamianReeves/write-file-action@master
    #   with:
    #     path: CHANGELOG.md
    #     contents: |
    #       ${{ steps.ch-template.outputs.content }}${{ steps.ch.outputs.changelog }}
    #     write-mode: overwrite

    - name: 'ğŸ–¨ï¸ Print changelog to console'
      run: |
        cat CHANGELOG.md

    - name: check local changes
      id: diff
      run: |
        changed_files=$(git status --porcelain --untracked-files=all | wc -l)
        echo ::set-output name=count::$changed_files
        echo ::set-output name=created::$(date)
      shell: bash

    #  apply tag
    - uses: stefanzweifel/git-auto-commit-action@v4
      with:
        file_pattern: CHANGELOG.md
        commit_message: |
          'docs: Update CHANGELOG.md "${{ github.workflow }} #${{ github.run_number }}" [skip ci]'



    # - name: check outputs
    #   if: ${{ steps.ch.outputs.skipped == 'false' }}
    #   run: |
    #     echo "Pull Request Number - ${{ steps.cpr.outputs.pull-request-number }}"
    #     echo "Pull Request URL - ${{ steps.cpr.outputs.pull-request-url }}"
